console.clear();const canvas=document.querySelector("#bubble");let width=canvas.offsetWidth,height=canvas.offsetHeight;const renderer=new THREE.WebGLRenderer({canvas:canvas,antialias:!0,alpha:!0}),scene=new THREE.Scene,setup=()=>{renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(width,height),renderer.setClearColor(15461355,0),renderer.shadowMap.enabled=!0,renderer.shadowMapSoft=!0,scene.fog=new THREE.Fog(0,10,950);const e=width/height;camera=new THREE.PerspectiveCamera(100,e,.1,1e4),camera.position.x=-300,camera.position.y=0,camera.position.z=300};let hemispshereLight,shadowLight,light2;setup();const createLights=()=>{hemisphereLight=new THREE.HemisphereLight(16777215,0,.5),(shadowLight=new THREE.DirectionalLight(5592405,.4)).position.set(0,450,350),shadowLight.castShadow=!0,shadowLight.shadow.camera.left=-650,shadowLight.shadow.camera.right=650,shadowLight.shadow.camera.top=650,shadowLight.shadow.camera.bottom=-650,shadowLight.shadow.camera.near=1,shadowLight.shadow.camera.far=1e3,shadowLight.shadow.mapSize.width=4096,shadowLight.shadow.mapSize.height=4096,(light2=new THREE.DirectionalLight(16777215,.25)).position.set(-600,350,350),light3=new THREE.DirectionalLight(16773456,.15),light3.position.set(0,-250,300),scene.add(hemisphereLight),scene.add(shadowLight),scene.add(light2),scene.add(light3)};hemisphereLight=new THREE.HemisphereLight(16777215,0,.5),(shadowLight=new THREE.DirectionalLight(5592405,.4)).position.set(0,450,350),shadowLight.castShadow=!0,shadowLight.shadow.camera.left=-650,shadowLight.shadow.camera.right=650,shadowLight.shadow.camera.top=650,shadowLight.shadow.camera.bottom=-650,shadowLight.shadow.camera.near=1,shadowLight.shadow.camera.far=1e3,shadowLight.shadow.mapSize.width=4096,shadowLight.shadow.mapSize.height=4096,(light2=new THREE.DirectionalLight(16777215,.25)).position.set(-600,350,350),light3=new THREE.DirectionalLight(16773456,.15),light3.position.set(0,-250,300),scene.add(hemisphereLight),scene.add(shadowLight),scene.add(light2),scene.add(light3);const vertex=width>575?80:40,bubbleGeometry=new THREE.SphereGeometry(120,vertex,vertex);let bubble;const createBubble=()=>{for(let e=0;e<bubbleGeometry.vertices.length;e++){let t=bubbleGeometry.vertices[e];t.original=t.clone()}const e=new THREE.MeshStandardMaterial({emissive:3355593,emissiveIntensity:1,roughness:.61,metalness:.9,side:THREE.FrontSide});(bubble=new THREE.Mesh(bubbleGeometry,e)).castShadow=!0,bubble.receiveShadow=!1,scene.add(bubble)};createBubble();const createPlane=()=>{const e=new THREE.PlaneBufferGeometry(2e3,2e3),t=new THREE.ShadowMaterial({opacity:.15}),a=new THREE.Mesh(e,t);a.position.y=-150,a.position.x=0,a.position.z=0,a.rotation.x=Math.PI/180*-90,a.receiveShadow=!0,scene.add(a)};createPlane();const map=(e,t,a,i,s)=>(e-t)*(s-i)/(a-t)+i,distance=(e,t)=>{const a=e.x-t.x,i=e.y-t.y;return Math.sqrt(a*a+i*i)};let mouse=new THREE.Vector2(0,0);const onMouseMove=e=>{TweenMax.to(mouse,.8,{x:e.clientX||e.pageX||e.touches[0].pageX||0,y:e.clientY||e.pageY||e.touches[0].pageY||0,ease:Power2.easeOut})};["mousemove","touchmove"].forEach(e=>{window.addEventListener(e,onMouseMove)});let spring={scale:1};const clicking={down:()=>{TweenMax.to(spring,.7,{scale:.7,ease:Power3.easeOut})},up:()=>{TweenMax.to(spring,.9,{scale:1,ease:Elastic.easeOut})}};["mousedown","touchstart"].forEach(e=>{window.addEventListener(e,clicking.down)}),["mouseup","touchend"].forEach(e=>{window.addEventListener(e,clicking.up)});const onResize=()=>{canvas.style.width="",canvas.style.height="",width=canvas.offsetWidth,height=canvas.offsetHeight,camera.aspect=width/height,camera.updateProjectionMatrix(),maxDist=distance(mouse,{x:width/2,y:height/2}),renderer.setSize(width,height)};let resizeTm;window.addEventListener("resize",function(){resizeTm=clearTimeout(resizeTm),resizeTm=setTimeout(onResize,200)});let dist=new THREE.Vector2(0,0),maxDist=distance(mouse,{x:width/2,y:height/2});const updateVertices=e=>{dist=distance(mouse,{x:width/2,y:height/2}),dist=map(dist/=maxDist,1,0,0,1);for(let t=0;t<bubbleGeometry.vertices.length;t++){let a=bubbleGeometry.vertices[t];a.copy(a.original);let i=.3*noise.simplex3(.006*a.x+5e-4*e,.006*a.y+5e-4*e,.006*a.z)*(dist+.1)+.8;a.multiplyScalar(i)}bubbleGeometry.verticesNeedUpdate=!0},render=e=>{requestAnimationFrame(render),bubble.rotation.y=-4+map(mouse.x,0,width,0,4),bubble.rotation.z=4+map(mouse.y,0,height,0,-4),bubble.scale.set(spring.scale,spring.scale,spring.scale),updateVertices(e),renderer.clear(),renderer.render(scene,camera)};requestAnimationFrame(render),renderer.render(scene,camera);